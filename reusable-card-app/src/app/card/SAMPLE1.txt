 @Test
    void testInsertPaymentLines_Success() {
        // Create a list of PaymentLinesFeoModel objects
        List<PaymentLinesFeoModel> paymentLines = new ArrayList<>();
        PaymentLinesFeoModel paymentLine1 = new PaymentLinesFeoModel();
        paymentLine1.setInvoiceReference("INV123");
        paymentLine1.setAmount(BigDecimal.TEN);
        paymentLine1.setProviderId("PROV1");
        paymentLine1.setProviderMnemonic("MNEM1");
        paymentLines.add(paymentLine1);

        // Mock InvoiceServiceApi.getListOfInvoices()
        List<InvoicePayableModel> invoices = new ArrayList<>();
        InvoicePayableModel invoice1 = new InvoicePayableModel();
        invoice1.setInvoiceReference("INV123");
        invoice1.setAmount(BigDecimal.TEN);
        invoice1.setInvoiceType("CREDIT");
        invoices.add(invoice1);

        when(invoiceServiceApi.getListOfInvoices(List.of("INV123"))).thenReturn(invoices);

        // Mock ReferentialServiceApi.getProviderDetails()
        when(referentialServiceApi.getProviderDetails("PROV1", "MNEM1")).thenReturn(new ProviderDetails());

        // Mock ReferentialServiceApi.getUserInitials()
        when(referentialServiceApi.getUserInitials("testUser")).thenReturn(new UserDetailsModel());

        // Call the method
        InsertPaymentResponse response = cashAllocationDomain.insertPaymentLines(paymentLines, "testUser");

        // Verify that the response is successful
        assertNull(response.getErrorMessage());
    }

    @Test
    void testInsertPaymentLines_AmountMismatch() {
        // Create a list of PaymentLinesFeoModel objects
        List<PaymentLinesFeoModel> paymentLines = new ArrayList<>();
        PaymentLinesFeoModel paymentLine1 = new PaymentLinesFeoModel();
        paymentLine1.setInvoiceReference("INV123");
        paymentLine1.setAmount(BigDecimal.TEN);
        paymentLines.add(paymentLine1);

        // Mock InvoiceServiceApi.getListOfInvoices()
        List<InvoicePayableModel> invoices = new ArrayList<>();
        InvoicePayableModel invoice1 = new InvoicePayableModel();
        invoice1.setInvoiceReference("INV123");
        invoice1.setAmount(BigDecimal.FIVE); // Mismatched amount
        invoice1.setInvoiceType("CREDIT");
        invoices.add(invoice1);

        when(invoiceServiceApi.getListOfInvoices(List.of("INV123"))).thenReturn(invoices);

        // Call the method and verify the error
        InsertPaymentResponse response = cashAllocationDomain.insertPaymentLines(paymentLines, "testUser");
        assertNotNull(response.getErrorMessage());
    }

    @Test
    void testInsertPaymentLines_InvoiceException() {
        // Create a list of PaymentLinesFeoModel objects
        List<PaymentLinesFeoModel> paymentLines = new ArrayList<>();
        PaymentLinesFeoModel paymentLine1 = new PaymentLinesFeoModel();
        paymentLine1.setInvoiceReference("INV123");
        paymentLines.add(paymentLine1);

        // Mock InvoiceServiceApi.getListOfInvoices() to throw an exception
        when(invoiceServiceApi.getListOfInvoices(List.of("INV123"))).thenThrow(new RuntimeException("Invoice exception"));

        // Call the method and verify the error
        InsertPaymentResponse response = cashAllocationDomain.insertPaymentLines(paymentLines, "testUser");
        assertNotNull(response.getErrorMessage());
    }

    @Test
    void testInsertPaymentLines_ProviderException() {
        // Create a list of PaymentLinesFeoModel objects
        List<PaymentLinesFeoModel> paymentLines = new ArrayList<>();
        PaymentLinesFeoModel paymentLine1 = new PaymentLinesFeoModel();
        paymentLine1.setInvoiceReference("INV123");
        paymentLine1.setProviderId("PROV1");
        paymentLine1.setProviderMnemonic("MNEM1");
        paymentLines.add(paymentLine1);

        // Mock InvoiceServiceApi.getListOfInvoices()
        List<InvoicePayableModel> invoices = new ArrayList<>();
        InvoicePayableModel invoice1 = new InvoicePayableModel();
        invoice1.setInvoiceReference("INV123");
        invoice1.setAmount(BigDecimal.TEN);
        invoice1.setInvoiceType("CREDIT");
        invoices.add(invoice1);

        when(invoiceServiceApi.getListOfInvoices(List.of("INV123"))).thenReturn(invoices);

        // Mock ReferentialServiceApi.getProviderDetails() to throw an exception
        when(referentialServiceApi.getProviderDetails("PROV1", "MNEM1")).thenThrow(new RuntimeException("Provider exception"));

        // Call the method and verify the error
        InsertPaymentResponse response = cashAllocationDomain.insertPaymentLines(paymentLines, "testUser");
        assertNotNull(response.getErrorMessage());
    }

    @Test
    void testInsertPaymentLines_UserException() {
        // Create a list of PaymentLinesFeoModel objects
        List<PaymentLinesFeoModel> paymentLines = new ArrayList<>();
        PaymentLinesFeoModel paymentLine1 = new PaymentLinesFeoModel();
        paymentLine1.setInvoiceReference("INV123");
        paymentLines.add(paymentLine1);

        // Mock InvoiceServiceApi.getListOfInvoices()
        List<InvoicePayableModel> invoices = new ArrayList<>();
        InvoicePayableModel invoice1 = new InvoicePayableModel();
        invoice1.setInvoiceReference("INV123");
        invoice1.setAmount(BigDecimal.TEN);
        invoice1.setInvoiceType("CREDIT");
        invoices.add(invoice1);

        when(invoiceServiceApi.getListOfInvoices(List.of("INV123"))).thenReturn(invoices);

        // Mock ReferentialServiceApi.getUserInitials() to throw an exception
        when(referentialServiceApi.getUserInitials("testUser")).thenThrow(new RuntimeException("User exception"));

        // Call the method and verify the error
        InsertPaymentResponse response = cashAllocationDomain.insertPaymentLines(paymentLines, "testUser");
        assertNotNull(response.getErrorMessage());
    }