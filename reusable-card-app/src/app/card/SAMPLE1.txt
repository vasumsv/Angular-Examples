
    @Test
    void testAutoPaymentMatching_NotAllocatedModel() {
        // Mock InvoiceServiceApi.getSd2Invoice()
        InvoiceSd2Model invoiceSd2Model = new InvoiceSd2Model();
        invoiceSd2Model.setInvoices(List.of(new Invoice())); // Corrected line

        when(invoiceServiceApi.getSd2Invoice(anyString())).thenReturn(invoiceSd2Model);

        // Mock CashAllocationRepositoryApi.findByInvoiceReferenceReceived()
        CashAllocationModel notAllocatedModel = new CashAllocationModel();
        notAllocatedModel.setStatus("NOT_ALLOCATED");
        notAllocatedModel.setId(123L);
        notAllocatedModel.setAmount(BigDecimal.TEN);
        notAllocatedModel.setValueDate(LocalDate.now());

        List<CashAllocationModel> cashAllocationModels = List.of(notAllocatedModel);
        when(cashAllocationRepositoryApi.findByInvoiceReferenceReceived(anyString())).thenReturn(cashAllocationModels);

        // Call the method
        cashAllocationDomain.autoPaymentMatching();

        // Verify that findByInvoiceReferenceReceived() was called
        verify(cashAllocationRepositoryApi).findByInvoiceReferenceReceived(anyString());

        // Verify that processingCashAllocation() was called
        verify(cashAllocationDomain).processingCashAllocation(eq("MATCHED"), any(ProcessCashRequest.class), eq("AutoPaymentMatching"));
    }